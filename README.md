# 城市人效与CR值分析工具

一个基于Streamlit的交互式图表绘制工具，用于分析城市级别的人效指标与CR值关系，帮助识别超额支付、合理区间、价值低估的城市。

## 功能特性

### 核心功能
- **数据导入**：支持Excel和CSV文件导入，包含城市名称、人效值、CR值、离职率
- **自动绘图**：生成双变量散点图，X轴为人效，Y轴为CR值
- **区域划分**：按照配置规则自动划分三个颜色区域（红色超额、绿色合理、蓝色低估）
- **趋势分析**：显示标准趋势线和上下边界线
- **结果导出**：支持PNG格式图片导出

### 界面布局
- **左侧**：参数配置面板，支持自定义各种图形参数
- **右侧上方**：数据导入和表格展示区域
- **右侧下方**：图表展示区域
- **底部**：图表生成和导出按钮

## 安装和运行

### 1. 安装依赖
```bash
pip install -r requirements.txt
```

### 2. 运行应用
```bash
streamlit run app.py
```

### 3. 访问应用
在浏览器中打开 `http://localhost:8501`

## 使用说明

### 数据格式要求
输入数据应包含以下四列：
- **城市**：城市名称，用作散点图标签
- **人效**：横轴（X轴）指标
- **CR值**：纵轴（Y轴）指标
- **离职率**：用于控制点的颜色深度

### 示例数据
```
城市,人效,CR值,离职率
北京,5.2,1.3,0.05
上海,6.1,1.25,0.20
深圳,5.8,1.15,0.01
```

### 操作流程
1. 在左侧参数配置面板设置图表参数
2. 点击"导入数据"按钮选择Excel或CSV文件，或使用示例数据
3. 在数据预览区域查看和编辑数据
4. 点击"生成图表"按钮生成散点图
5. 点击"导出图表"按钮保存PNG图片

## 参数配置说明

### 坐标轴配置
- X轴和Y轴的最大值、最小值
- X轴步长计算常量

### 基准点配置
- 两个基准点坐标，用于计算标准线

### 边界线配置
- **浮动比例**：标准线上下浮动的比例
- **上边界Y轴阈值**：上边界线斜率变化的Y轴阈值
- **上边界斜率变化比例**：超过阈值后的斜率变化比例
- **下边界Y轴阈值**：下边界线斜率变化的Y轴阈值
- **下边界斜率变化比例**：低于阈值后的斜率变化比例

### 颜色配置
- 合理区间区域颜色（默认绿色）
- 超额支付区域颜色（默认红色）
- 价值低估区域颜色（默认蓝色）

## 区域划分规则

1. **标准线**：根据两个基准点绘制直线
2. **上边界线**：
   - 标准线斜率不变，截距增加浮动比例
   - 当Y轴值大于上边界阈值时，斜率乘以变化比例
3. **下边界线**：
   - 标准线斜率不变，截距减少浮动比例
   - 当Y轴值小于下边界阈值时，斜率乘以变化比例
4. **区域分类**：
   - 上边界线以上：超额支付区域（红色）
   - 下边界线以下：价值低估区域（蓝色）
   - 中间区域：合理区间（绿色）

## 技术栈

- **前端框架**：Streamlit
- **数据处理**：Pandas
- **图表绘制**：Matplotlib
- **数值计算**：NumPy
- **文件处理**：openpyxl, xlrd

## 浏览器支持

- Chrome
- Safari
- Edge
- Firefox

## 特性

- 响应式布局，适配不同屏幕尺寸
- 交互式参数配置
- 实时数据编辑
- 高质量图表导出
- 中文界面支持

## 注意事项

- 确保数据文件格式正确，包含必需的四列数据
- 参数配置会实时影响图表生成结果
- 导出的图片为高分辨率PNG格式，适合用于报告
- 建议使用现代浏览器以获得最佳体验